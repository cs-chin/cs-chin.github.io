<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
	<meta name="theme-color" content="#222f4e">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-title" content="PWA">
	<link rel="manifest" href="/manifest.json" />
	<link rel="apple-touch-icon" href="/images/icon-72.png" sizes="72x72">
	<link rel="apple-touch-icon" href="/images/icon-114.png" sizes="114x114">
	<link rel="apple-touch-icon" href="/images/icon-120.png" sizes="120x120">
	<link rel="apple-touch-icon" href="/images/icon-144.png" sizes="144x144">
	<link rel="shortcut icon" href="https://cs-chin.github.io/images/favicon.ico" type="image/vnd.microsoft.icon" />
	<script async src="https://cdn.jsdelivr.net/npm/pwacompat@2.0.6/pwacompat.min.js"
    integrity="sha384-GOaSLecPIMCJksN83HLuYf9FToOiQ2Df0+0ntv7ey8zjUHESXhthwvq9hXAZTifA"
	crossorigin="anonymous"></script>
	
	<title>初めてのPWS</title>
</head>
<body>
	<h1>初めてのPWS</h1>
	<img src="./images/icon-256.png" alt="" class="image" />
	<div id="btnAdd">Install</div>

<script>
/* serviceWorker */
if ('serviceWorker' in navigator) {
	navigator.serviceWorker.register('/sw.js', { scope: '/' })
	.then(function(reg) {
		console.log('登録に成功しました。 Scope は ' + reg.scope);
		// alert('登録に成功しました。 Scope は ' + reg.scope);
	}).catch(function(error) {
		console.log('登録に失敗しました。' + error);
		// alert('登録に失敗しました。' + error);
	});
}

let deferredPrompt;
let btnAdd = document.getElementById('btnAdd');

window.addEventListener('beforeinstallprompt', (e) => {
	e.preventDefault();
	// Stash the event so it can be triggered later.
	deferredPrompt = e;
	btnAdd.style.display = 'block';
  // Stash the event so it can be triggered later.
//   deferredPrompt = e;
//   ...
});

btnAdd.addEventListener('click', (e) => {
	// hide our user interface that shows our APP button
	btnAdd.style.display = 'none';
	// Show the prompt
	deferredPrompt.prompt();
	// Wait for the user to respond to the prompt
	deferredPrompt.userChoice
	.then((choiceResult) => {
		if (choiceResult.outcome === 'accepted') {
			console.log('User accepted the APP prompt');
		} else {
			console.log('User dismissed the APP prompt');
		}
		deferredPrompt = null;
	});
});

window.addEventListener('appinstalled', (evt) => {
  console.log('app installed');
});
</script>
</body>
</html>
